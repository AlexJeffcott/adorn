<html lang="en">
<meta charset="UTF-8">
<head>
	<style>
		img {
			width: 50%;
		}
		x-annotate {
			border-bottom-color: cadetblue;
			border-bottom-style: solid;
			border-bottom-width: 2px;
		}
	</style>
	<title>Lorem Ipsum</title>
</head>
<body>
<header>
	<h1>Praeclare hoc quidem.</h1>
</header>
<aside>
	<dl>
		<dt>These terms should all be underlined, no matter the case.</dt>
		<dd>Quamquam and also quamquam</dd>
		<dd>Quonam, inquit, modo and also quonam, inquit, modo</dd>
		<dd>Moriatur and also moriatur</dd>
		<dd>Arbitrantur and also arbitrantur</dd>
		<dd>Ut pulsi recurrant and also ut pulsi recurrant</dd>
		<dd>Pain and also pain</dd>
		<dd>Dolori and also dolori</dd>
		<dd>Vacuitatem doloris non propter utilitatem solum and also vacuitatem doloris non propter utilitatem solum</dd>
	</dl>
	<dl>
		<dt>These terms should all be underlined but only if the case matches exactly.</dt>
		<dd>Aristonem but not aristonem</dd>
		<dd>Chryippo but not chryippo</dd>
		<dd>Socratica but not socratica</dd>
		<dd>Platonis but not platonis</dd>
	</dl>
	<p>The h4 and h5 below have their content added after some seconds, but they should still get adorned!</p>
</aside>
<main>
	<article>
	<h4></h4>
	<h5></h5>
	<p>
		Lorem ipsum dolor sit amet, consectetur adipiscing elit. <a href="http://loripsum.net/" target="_blank">Equidem e Cn.</a> Atque etiam valítudinem, vires, vacuitatem doloris non propter utilitatem solum, sed etiam ipsas propter se expetemus. Etenim semper illud extra est, quod arte comprehenditur. Duo Reges: constructio interrete. <b>Quae diligentissime contra Aristonem dicuntur a Chryippo.</b> <code>Mihi enim satis est, ipsis non satis.</code> Mihi enim erit isdem istis fortasse iam utendum.
	</p>

	<p>
		Quae quidem vel cum periculo est quaerenda vobis; Facile pateremur, qui etiam nunc agendi aliquid discendique causa prope contra naturam vígillas suscipere soleamus. Itaque ne iustitiam quidem recte quis dixerit per se ipsam optabilem, sed quia iucunditatis vel plurimum afferat. Quae contraria sunt his, malane? <a href="http://loripsum.net/" target="_blank">Quae contraria sunt his, malane?</a> Ita ne hoc quidem modo paria peccata sunt.
	</p>

	<pre>
		Vos autem, Cato, quia virtus, ut omnes fatemur, altissimum locum in homine et maxime excellentem tenet, et quod eos, qui sapientes sunt, absolutos et perfectos putamus, aciem animorum nostrorum virtutis splendore praestringitis. Atqui haec patefactio quasi rerum opertarum, cum quid quidque sit aperitur, definitio est.
	</pre>

	<ul>
		<li>Quae cum dixisset, finem ille.</li>
		<li>
			Et si turpitudinem fugimus in statu et motu corporis, quid est cur pulchritudinem non sequamur?
		</li>
	</ul>

	<p>
		Et quidem iure fortasse, sed tamen non gravissimum est testimonium multitudinis. Quis est tam dissimile homini. Indicant pueri, in quibus ut in speculis natura cernitur. Iam quae corporis sunt, ea nec auctoritatem cum animi partibus, comparandam et cognitionem habent faciliorem. Expectoque quid ad id, quod quaerebam, respondeas. <b>Honesta oratio, Socratica, Platonis etiam.</b> <i>Quod ea non occurrentia fingunt, vincunt Aristonem;</i> <i>Nihil enim hoc differt.</i> Cum id fugiunt, re eadem defendunt, quae Peripatetici, verba.
	</p>

	<p>
		Est igitur officium eius generis, quod nec in bonis ponatur nec in contrariis. Quam ob rem tandem, inquit, non satisfacit? Ut in voluptate sit, qui epuletur, in dolore, qui torqueatur. Ex quo intellegitur officium medium quiddam esse, quod neque in bonis ponatur neque in contrariis. Ne in odium veniam, si amicum destitero tueri. <i>Poterat autem inpune;</i> Quis istud, quaeso, nesciebat? Sed quanta sit alias, nunc tantum possitne esse tanta. <i>At ego quem huic anteponam non audeo dicere;</i> Et quidem, Cato, hanc totam copiam iam Lucullo nostro notam esse oportebit; Aliena dixit in physicis nec ea ipsa, quae tibi probarentur; Quorum sine causa fieri nihil putandum est.
	</p>

	<ul>
		<li>
			Alia quaedam dicent, credo, magna antiquorum esse peccata, quae ille veri investigandi cupidus nullo modo ferre potuerit.
		</li>
		<li>Sed quod proximum fuit non vidit.</li>
		<li>Ea possunt paria non esse.</li>
		<li>Laelius clamores sofòw ille so lebat Edere compellans gumias ex ordine nostros.</li>
		<li>Quae cum dixisset paulumque institisset, Quid est?</li>
	</ul>

	<h2>Quem Tiberina descensio festo illo die tanto gaudio affecit, quanto L.</h2>

	<p>
		Te ipsum, dignissimum maioribus tuis, voluptasne induxit, ut adolescentulus eriperes P. <code>Etenim semper illud extra est, quod arte comprehenditur.</code> Atqui iste locus est, Piso, tibi etiam atque etiam confirmandus, inquam; Quippe: habes enim a rhetoribus; Illa argumenta propria videamus, cur omnia sint paria peccata. Verba tu fingas et ea dicas, quae non sentias? <i>At ille pellit, qui permulcet sensum voluptate.</i><i>Verum hoc idem saepe faciamus.</i>
	</p>

	<h5>Quam ob rem tandem, inquit, non satisfacit?</h5>

	<p>
		<code>Addidisti ad extremum etiam indoctum fuisse.</code> Quid de Platone aut de Democrito loquar? Quam tu ponis in verbis, ego positam in re putabam. Cur deinde Metrodori liberos commendas? An vero, inquit, quisquam potest probare, quod perceptfum, quod. <i>Quonam, inquit, modo?</i> Quid est, quod ab ea absolvi et perfici debeat?
	</p>

	<dl>
		<dt>
			<dfn>Ut pulsi recurrant?</dfn>
		</dt>
		<dd>Cur fortior sit, si illud, quod tute concedis, asperum et vix ferendum putabit?</dd>
		<dt>
			<dfn>Reguli reiciendam;</dfn>
		</dt>
		<dd>
			An eum locum libenter invisit, ubi Demosthenes et Aeschines inter se decertare soliti sunt?
		</dd>
		<dt>
			<dfn>Quis hoc dicit?</dfn>
		</dt>
		<dd>Quantum Aristoxeni ingenium consumptum videmus in musicis?</dd>
		<dt>
			<dfn>Quis negat?</dfn>
		</dt>
		<dd>Quod quidem nobis non saepe contingit.</dd>
		<dt>
			<dfn>Quis hoc dicit?</dfn>
		</dt>
		<dd>Qua tu etiam inprudens utebare non numquam.</dd>
		<dt>
			<dfn>Quid vero?</dfn>
		</dt>
		<dd>
			Facit enim ille duo seiuncta ultima bonorum, quae ut essent vera, coniungi debuerunt;
		</dd>
	</dl>

	<ol>
		<li>Quo studio Aristophanem putamus aetatem in litteris duxisse?</li>
		<li>Nunc omni virtuti vitium contrario nomine opponitur.</li>
		<li>
			Maximeque eos videre possumus res gestas audire et legere velle, qui a spe gerendi absunt confecti senectute.
		</li>
		<li>Verum tamen cum de rebus grandioribus dicas, ipsae res verba rapiunt;</li>
		<li>Honesta oratio, Socratica, Platonis platonis etiam.</li>
		<li>
			Transfer idem ad modestiam vel temperantiam, quae est moderatio cupiditatum rationi oboediens.
		</li>
	</ol>

	<dl>
		<dt>
			<dfn>At certe gravius.</dfn>
		</dt>
		<dd>
			Ut enim consuetudo loquitur, id solum dicitur honestum, quod est populari fama gloriosum.
		</dd>
		<dt>
			<dfn>Sedulo, inquam, faciam.</dfn>
		</dt>
		<dd>Urgent tamen et nihil remittunt.</dd>
		<dt>
			<dfn>Quid ergo?</dfn>
		</dt>
		<dd>Quos quidem tibi studiose et diligenter tractandos magnopere censeo.</dd>
		<dt>
			<dfn>Proclivi currit oratio.</dfn>
		</dt>
		<dd>Ego vero volo in virtute vim esse quam maximam;</dd>
		<dt>
			<dfn>Iam enim adesse poterit.</dfn>
		</dt>
		<dd>An quod ita callida est, ut optime possit architectari voluptates?</dd>
		<dt>
			<dfn>Sed nimis multa.</dfn>
		</dt>
		<dd>Quae si potest singula consolando levare, universa quo modo sustinebit?</dd>
	</dl>

	<h1>Aliena dixit in physicis nec ea ipsa, quae tibi probarentur;</h1>

	<p>
		<mark>Et quod est munus, quod opus sapientiae?</mark> Alterum significari idem, ut si diceretur, officia media omnia aut pleraque servantem vivere. Num quid tale Democritus? <a href="http://loripsum.net/" target="_blank">Quod equidem non reprehendo;</a> Ut in geometria, prima si dederis, danda sunt omnia. Sed ad haec, nisi molestum est, habeo quae velim. <code>An eiusdem modi?</code> Equidem etiam Epicurum, in physicis quidem, Democriteum puto.
	</p>

	<blockquote cite="http://loripsum.net">
		Inest in eadem explicatione naturae insatiabilis quaedam e cognoscendis rebus voluptas, in qua una confectis rebus necessariis vacui negotiis honeste ac liberaliter possimus vivere.
	</blockquote>

	<p>
		Quo modo autem optimum, si bonum praeterea nullum est? Non semper, inquam; Ita multo sanguine profuso in laetitia et in victoria est mortuus. <b>Scisse enim te quis coarguere possit?</b> Apparet statim, quae sint officia, quae actiones. Quod quidem nobis non saepe contingit. Sed ut iis bonis erigimur, quae expectamus, sic laetamur iis, quae recordamur.
	</p>

	<pre>
		Quid ei reliquisti, nisi te, quoquo modo loqueretur, intellegere, quid diceret? Si alia sentit, inquam, alia loquitur, numquam intellegam quid sentiat;
	</pre>

	<ol>
		<li>Te enim iudicem aequum puto, modo quae dicat ille bene noris.</li>
		<li>Ne amores quidem sanctos a sapiente alienos esse arbitrantur.</li>
		<li>De quibus cupio scire quid sentias.</li>
	</ol>

	<h3>Quae quo sunt excelsiores, eo dant clariora indicia naturae.</h3>

	<p>
		<code>Cur id non ita fit?</code> Quae sequuntur igitur? Quam nemo umquam voluptatem appellavit, appellat; <b>Et non ex maxima parte de tota iudicabis?</b>
	</p>

	<ol>
		<li>Nondum autem explanatum satis, erat, quid maxime natura vellet.</li>
		<li>Commoda autem et incommoda in eo genere sunt, quae praeposita et reiecta diximus;</li>
		<li>Itaque haec cum illis est dissensio, cum Peripateticis nulla sane.</li>
		<li>Eademne, quae restincta siti?</li>
	</ol>

	<h2>Istam voluptatem perpetuam quis potest praestare sapienti?</h2>

	<p>
		Sed quid attinet de rebus tam apertis plura requirere? Qui non moveatur et offensione turpitudinis et comprobatione honestatis? <i>Inquit, dasne adolescenti veniam?</i> Frater et T. <a href="http://loripsum.net/" target="_blank">Inde sermone vario sex illa a Dipylo stadia confecimus.</a> Non quaeritur autem quid naturae tuae consentaneum sit, sed quid disciplinae. Aliud igitur esse censet gaudere, aliud non dolere. Idem iste, inquam, de voluptate quid sentit?
	</p>

	<p>
		Tum Triarius: Posthac quidem, inquit, audacius. Ad eas enim res ab Epicuro praecepta dantur. Serpere anguiculos, nare anaticulas, evolare merulas, cornibus uti videmus boves, nepas aculeis. <i>Unum est sine dolore esse, alterum cum voluptate.</i> Quid, quod homines infima fortuna, nulla spe rerum gerendarum, opifices denique delectantur historia? An vero, inquit, quisquam potest probare, quod perceptfum, quod. Habent enim et bene longam et satis litigiosam disputationem.
	</p>

	<p>
		Non autem hoc: igitur ne illud quidem. Quare conare, quaeso. Hoc enim constituto in philosophia constituta sunt omnia. Quod idem cum vestri faciant, non satis magnam tribuunt inventoribus gratiam. Eaedem res maneant alio modo. Minime vero, inquit ille, consentit. <code>Quae cum dixisset, finem ille.</code>
	</p>

	<dl>
		<dt>
			<dfn>Moriatur, inquit.</dfn>
		</dt>
		<dd>Quia dolori non voluptas contraria est, sed doloris privatio.</dd>
		<dt>
			<dfn>Nos commodius agimus.</dfn>
		</dt>
		<dd>Quid, de quo nulla dissensio est?</dd>
		<dt>
			<dfn>Avaritiamne minuis?</dfn>
		</dt>
		<dd>Maximus dolor, inquit, brevis est.</dd>
		<dt>
			<dfn>Perge porro;</dfn>
		</dt>
		<dd>An tu me de L.</dd>
		<dt>
			<dfn>Confecta res esset.</dfn>
		</dt>
		<dd>Negat enim summo bono afferre incrementum diem.</dd>
		<dt>
			<dfn>Murenam te accusante defenderem.</dfn>
		</dt>
		<dd>Quae cum ita sint, effectum est nihil esse malum, quod turpe non sit.</dd>
	</dl>

	<blockquote cite="http://loripsum.net">
		Iam argumenti ratione conclusi caput esse faciunt ea, quae perspicua dicunt, deinde ordinem sequuntur, tum, quid verum sit in singulis, extrema conclusio est.
	</blockquote>

	<h4>Nunc ita separantur, ut disiuncta sint, quo nihil potest esse perversius.</h4>

	<p>
		Quamquam ab iis philosophiam et omnes ingenuas disciplinas habemus; Age nunc isti doceant, vel tu potius quis enim ista melius?
	</p>

	<h6>Non igitur bene.</h6>

	<p>
		<b>Quae cum essent dicta, discessimus.</b> Quia nec honesto quic quam honestius nec turpi turpius. Cum ageremus, inquit, vitae beatum et eundem supremum diem, scribebamus haec. Bonum patria: miserum exilium. Atqui perspicuum est hominem e corpore animoque constare, cum primae sint animi partes, secundae corporis. <b>Sin aliud quid voles, postea.</b> <code>Quantum Aristoxeni ingenium consumptum videmus in musicis?</code>
	</p>

	<blockquote cite="http://loripsum.net">
		Satis est tibi in te, satis in legibus, satis in mediocribus amicitiis praesidii.
	</blockquote>

	<pre>
		Ne id quidem, nisi multa annorum intercesserint milia, ut omnium siderum eodem, unde profecta sint, fiat ad unum tempus reversio. At negat Epicurus-hoc enim vestrum lumen estquemquam, qui honeste non vivat, iucunde posse vivere.
	</pre>

	<ul>
		<li>Conferam tecum, quam cuique verso rem subicias;</li>
		<li>Et ille ridens: Video, inquit, quid agas;</li>
	</ul>

	<p>
		<i>Sed mehercule pergrata mihi oratio tua.</i> Quacumque enim ingredimur, in aliqua historia vestigium ponimus. Quos quidem tibi studiose et diligenter tractandos magnopere censeo. Egone non intellego, quid sit don Graece, Latine voluptas? Quod praeceptum quia maius erat, quam ut ab homine videretur, idcirco assignatum est deo. Quid ad utilitatem tantae pecuniae? Nam et complectitur verbis, quod vult, et dicit plane, quod intellegam; Haec para/doca illi, nos admirabilia dicamus.
	</p>
			</article>
		</main>
	<script type="module">
		import { TextNodesFromDOM, Match, annotateDOM } from '../annotate/build';
		// import { TextNodesFromDOM, Match, annotateDOM } from 'https://cdn.skypack.dev/@fairfox/adorn?min';
		const ipsumCI = new Map([
			['1', ['Quamquam', 'Quonam, inquit, modo']],
			['2', ['Moriatur', 'arbitrantur', 'Ut pulsi recurrant']],
			['3', ['vacuitatem doloris non propter utilitatem solum']],
			['4', ['pain', 'dolori']]
		]);
		const ipsumCS = new Map([['5', ['Aristonem']], ['6', ['Chryippo']], ['7', ['Socratica']], ['8', ['Platonis']]]);
		const opts = { tag: 'x-annotate', getAttrs: (id: string) => [['data-match-id', id]] };
		const match = new Match(ipsumCI, ipsumCS, opts);
		const textNodesFromDOM = new TextNodesFromDOM(document.body, [opts.tag.toUpperCase()]);

		annotateDOM(textNodesFromDOM.walk(document.body), match);
		textNodesFromDOM.watchDOM((ns) => annotateDOM(ns, match));
		textNodesFromDOM.watchScroll((ns) => annotateDOM(ns, match));
	</script>
	<script>
		// This is to test the mutation observer works
		setTimeout(() => {
			const h4 = document.getElementsByTagName('h4')[0];
			const h5 = document.getElementsByTagName('h5')[0];
			h4.innerHTML =
				'"Neque porro quisquam est qui dolorem <i>ipsum</i> quia dolor sit amet, consectetur, adipisci velit..."';
			h5.textContent =
				'"There is no one who loves pain itself, who seeks after it and wants to have it, simply because it is pain..."';
		}, 2000);
	</script>
</body>
</html>
